<script>
  window.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contactForm');
    const responderStatusSelect = document.querySelector('select[name="responderStatus"]');
    const responderTypeSelect = document.querySelector('select[name="responderType"]');
    const responderFields = document.getElementById('responderFields');
    const civilianFields = document.getElementById('civilianFields');
    const fireFields = document.getElementById('fireFields');

    function toggleResponderFields(status) {
      if (status === 'Responder') {
        responderFields.style.display = 'block';
        civilianFields.style.display = 'none';
      } else if (status === 'Civilian') {
        responderFields.style.display = 'none';
        civilianFields.style.display = 'block';
      } else {
        responderFields.style.display = 'none';
        civilianFields.style.display = 'none';
      }
      // Reset responderType and hide fire fields when responderFields hidden
      if (responderFields.style.display === 'none') {
        responderTypeSelect.value = '';
        fireFields.style.display = 'none';
      }
    }

    function toggleFireFields(type) {
      if (type === 'Fire') {
        fireFields.style.display = 'block';
      } else {
        fireFields.style.display = 'none';
      }
    }

    // Initialize visibility on load
    toggleResponderFields(responderStatusSelect.value);
    toggleFireFields(responderTypeSelect.value);

    // Event listeners
    responderStatusSelect.addEventListener('change', (e) => {
      toggleResponderFields(e.target.value);
    });

    responderTypeSelect.addEventListener('change', (e) => {
      toggleFireFields(e.target.value);
    });

    // Submit handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbyYa5_3wS_HEGIdKEhDEkT1Ufry2YoT3dmWwn9UJZegOoCzygbeQPnLoKxEWi_Pu1Mw/exec", {
          method: "POST",
          body: data,
        });
        if (response.ok) {
          const json = await response.json();
          if (json.redirect) {
            window.location.href = json.redirect;
          } else {
            window.location.href = "https://boxalarmconcepts.github.io/site/confirmation.html";
          }
        } else {
          alert("Submission failed. Please try again.");
        }
      } catch (error) {
        alert("There was an error submitting the form: " + error.message);
      }
    });
  });
</script>
